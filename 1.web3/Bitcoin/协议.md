# 双花攻击 Double Spending Attack

1、谁来发行货币？

2、如何防范 DSA？

## 1. **区块链结构**

比特币的协议基于**区块链**，即一个按时间顺序链接的、不可篡改的公开账本。每个区块包含以下核心组件：

- **区块头（Block Header）**：

  - **版本号**：标识协议的版本。

  - **前一个区块的哈希值**（Previous Block Hash）：确保链式连接，防止篡改。

  - **默克尔根（Merkle Root）**：所有交易的哈希汇总，用于快速验证交易完整性。

  - **时间戳**：区块生成的时间。

  - **难度目标**：当前网络挖矿难度的数值表示。

  - **Nonce**：随机数，用于工作量证明（PoW）计算。

- **交易列表**：包含该区块打包的交易数据。

---

### 2. **共识机制：工作量证明（PoW）**

比特币通过**工作量证明**（Proof of Work, PoW）确保网络的安全性和一致性：

- **挖矿过程**：

  - 矿工通过计算区块头的哈希值（SHA-256算法），寻找满足难度目标的 Nonce。

  - 第一个找到有效哈希的矿工获得记账权，并获得区块奖励（新生成的 BTC 和交易手续费）。

- **难度调整**：

  - 每 2016 个区块（约两周）调整一次难度，确保平均出块时间为 10 分钟。

---

### 3. **交易协议**

比特币交易基于**UTXO模型**（未花费交易输出）：

- **交易结构**：

  - **输入（Inputs）**：引用之前的 UTXO，并提供解锁脚本（签名）。

  - **输出（Outputs）**：指定接收方的比特币地址和金额。

  - **脚本系统**：使用比特币脚本（类似简单的编程语言）验证交易合法性（如 `P2PKH`, `P2SH` 等）。

- **交易验证**：

  - 节点通过验证签名和 UTXO 的有效性确认交易合法性。

---

### 4. **去中心化网络**

比特币网络由全球节点组成，无中心化服务器：

- **节点类型**：

  - **全节点**：存储完整区块链，验证所有交易和区块。

  - **矿工节点**：参与 PoW 竞争，打包交易。

  - **轻节点（SPV 节点）**：仅验证区块头，依赖全节点获取数据。

- **P2P 通信**：

  - 节点通过 Gossip 协议广播交易和区块，确保数据同步。

---

### 5. **安全性机制**

- **51% 攻击防御**：

  - 攻击者需控制超过 50% 的算力才能篡改交易，成本极高。

- **双花攻击防范**：

  - 交易需被多次确认（通常 6 个区块后视为安全）。

- **密码学保障**：

  - 使用 ECDSA（椭圆曲线数字签名算法）保护私钥和签名。

  - 哈希函数（SHA-256）确保数据不可逆和防篡改。

---

### 6. **经济模型**

- **发行机制**：

  - 每区块奖励初始为 50 BTC，每 21 万区块（约 4 年）减半，直至总量达 2100 万。
  - 当前（2023 年）区块奖励为 6.25 BTC，预计 2140 年全部挖完。
- **手续费机制**：
  - 用户支付交易手续费激励矿工打包交易，手续费随网络拥堵程度浮动。

---

### 7. **协议升级与分叉**

比特币协议通过软分叉或硬分叉升级：

- **软分叉**：向后兼容，旧节点仍可运行（如 SegWit 升级）。
- **硬分叉**：不兼容旧版本，可能产生新链（如 2017 年的比特币现金分叉）。

---

### 8. **局限性**

- **扩展性问题**：

  - 区块大小限制（1MB → SegWit 后提升至约 4MB）导致交易吞吐量低。
  - 第二层解决方案（如闪电网络）被开发以提高效率。

- **能源消耗**：

  - PoW 机制需要大量算力，引发环保争议。

---
