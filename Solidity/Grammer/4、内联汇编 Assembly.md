
å†…è”æ±‡ç¼–ï¼ˆInline Assemblyï¼‰æ˜¯ Solidity æä¾›çš„ä¸€ç§ç›´æŽ¥æ“ä½œ Ethereum è™šæ‹Ÿæœºï¼ˆEVMï¼‰æŒ‡ä»¤çš„æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…ç¼–å†™åº•å±‚çš„ EVM æŒ‡ä»¤ã€‚å®ƒé€‚ç”¨äºŽæ€§èƒ½ä¼˜åŒ–ã€ç›´æŽ¥è®¿é—®å†…å­˜æˆ–å®žçŽ° Solidity ä¸æ”¯æŒçš„ä½Žçº§åŠŸèƒ½ã€‚

##  å†…è”æ±‡ç¼–çš„å¸¸è§ç”¨é€”

 âœ… èŠ‚çœ gasï¼ˆç»•è¿‡ Solidity çš„é«˜å¼€é”€ï¼‰

 âœ… ç²¾ç»†æŽ§åˆ¶å†…å­˜ã€å­˜å‚¨ã€è°ƒç”¨

 âœ… å®žçŽ°åº•å±‚æ“ä½œï¼ˆå¦‚ `create2`, `extcodecopy`, `staticcall` ç­‰ï¼‰


- âœ… ä»Ž Solidity 0.8 å¼€å§‹ï¼Œ**æŽ¨èä½¿ç”¨ Yul**ï¼ˆä¸€ç§æ›´å®‰å…¨ã€æ›´ç»“æž„åŒ–çš„ä¸­é—´æ±‡ç¼–è¯­è¨€ï¼‰ã€‚
    
- ðŸš« å†…è”æ±‡ç¼–è·³è¿‡äº†å¤§å¤šæ•°ç¼–è¯‘å™¨æ£€æŸ¥ï¼Œå®¹æ˜“å‡ºé”™ã€‚
    
- ðŸš« è°ƒè¯•å›°éš¾ï¼Œå¯è¯»æ€§å·®ã€‚
    
- ðŸš« å¦‚æžœéžå¿…è¦ï¼Œ**ä¼˜å…ˆä½¿ç”¨ Solidity è¯­è¨€åŽŸç”Ÿç‰¹æ€§**ã€‚

| æŒ‡ä»¤                 | è¯´æ˜Ž          |
| ------------------ | ----------- |
| `add(x, y)`        | åŠ æ³•          |
| `sub(x, y)`        | å‡æ³•          |
| `mul(x, y)`        | ä¹˜æ³•          |
| `div(x, y)`        | é™¤æ³•ï¼ˆé™¤ä»¥é›¶è¿”å›ž 0ï¼‰ |
| `sdiv(x, y)`       | æœ‰ç¬¦å·é™¤æ³•       |
| `mod(x, y)`        | å–æ¨¡          |
| `smod(x, y)`       | æœ‰ç¬¦å·å–æ¨¡       |
| `addmod(x, y, m)`  | åŠ æ³•å–æ¨¡        |
| `mulmod(x, y, m)`  | ä¹˜æ³•å–æ¨¡        |
| `exp(x, y)`        | å¹‚è¿ç®—         |
| `signextend(b, x)` | ç¬¦å·æ‰©å±•        |
æ¯”è¾ƒé€»è¾‘ç¬¦

|æŒ‡ä»¤|è¯´æ˜Ž|
|---|---|
|`lt(x, y)`|å°äºŽ|
|`gt(x, y)`|å¤§äºŽ|
|`slt(x, y)`|æœ‰ç¬¦å·å°äºŽ|
|`sgt(x, y)`|æœ‰ç¬¦å·å¤§äºŽ|
|`eq(x, y)`|ç­‰äºŽ|
|`iszero(x)`|åˆ¤æ–­æ˜¯å¦ä¸ºé›¶|
|`and(x, y)`|ä¸Ž|
|`or(x, y)`|æˆ–|
|`xor(x, y)`|å¼‚æˆ–|
|`not(x)`|å–å|
|`byte(n, x)`|å–ç¬¬ `n` ä¸ªå­—èŠ‚ï¼ˆä»Žå·¦å¾€å³ï¼Œç¬¬ 0 ä¸ªå­—èŠ‚æ˜¯æœ€é«˜ä½ï¼‰|
|`shl(s, x)`|å·¦ç§»|
|`shr(s, x)`|é€»è¾‘å³ç§»|
|`sar(s, x)`|ç®—æœ¯å³ç§»ï¼ˆä¿ç•™ç¬¦å·ä½ï¼‰|
å†…å­˜ä¸Žå­˜å‚¨æ“ä½œ

|æŒ‡ä»¤|è¯´æ˜Ž|
|---|---|
|`mload(p)`|åŠ è½½å†…å­˜ï¼ˆä»Žä½ç½® `p` è¯»å– 32 å­—èŠ‚ï¼‰|
|`mstore(p, v)`|å­˜å‚¨åˆ°å†…å­˜ï¼ˆ32 å­—èŠ‚ï¼‰|
|`mstore8(p, v)`|å­˜å‚¨åˆ°å†…å­˜ï¼ˆ1 å­—èŠ‚ï¼‰|
|`sload(p)`|åŠ è½½å­˜å‚¨ï¼ˆçŠ¶æ€å˜é‡ï¼‰|
|`sstore(p, v)`|å­˜å‚¨åˆ°çŠ¶æ€å˜é‡ï¼ˆä¿®æ”¹ storageï¼‰|
çŽ¯å¢ƒä¿¡æ¯

|æŒ‡ä»¤|è¯´æ˜Ž|
|---|---|
|`address()`|å½“å‰åˆçº¦åœ°å€|
|`balance(addr)`|åœ°å€ä½™é¢|
|`selfbalance()`|åˆçº¦è‡ªèº«ä½™é¢ï¼ˆæ›´å®‰å…¨ï¼‰|
|`caller()`|è°ƒç”¨è€…åœ°å€ï¼ˆmsg.senderï¼‰|
|`callvalue()`|äº¤æ˜“é™„å¸¦çš„ ETH æ•°é‡|
|`calldataload(p)`|ä»Ž calldata åŠ è½½ 32 å­—èŠ‚|
|`calldatasize()`|calldata çš„å¤§å°|
|`calldatacopy(t, f, s)`|æ‹·è´ calldata åˆ°å†…å­˜|
|`codesize()`|å½“å‰åˆçº¦å­—èŠ‚ç å¤§å°|
|`codecopy(t, f, s)`|å°†åˆçº¦å­—èŠ‚ç æ‹·è´åˆ°å†…å­˜|
|`gas()`|å‰©ä½™ gas|
|`origin()`|äº¤æ˜“å‘èµ·è€…ï¼ˆtx.originï¼‰|
|`gasprice()`|gas ä»·æ ¼|
|`timestamp()`|åŒºå—æ—¶é—´æˆ³|
|`number()`|åŒºå—é«˜åº¦|
|`difficulty()`|æŒ–çŸ¿éš¾åº¦ï¼ˆå·²åºŸå¼ƒï¼‰|
|`prevrandao()`|åŒºå—éšæœºæ•°æ›¿ä»£ `difficulty()`|
|`basefee()`|EIP-1559 çš„ base fee|
|`chainid()`|å½“å‰é“¾ ID|
|`coinbase()`|å‡ºå—åœ°å€|
|`blockhash(n)`|ç¬¬ `n` ä¸ªåŒºå—çš„ hash|
|`extcodesize(a)`|å¤–éƒ¨åˆçº¦çš„ä»£ç å¤§å°|
|`extcodecopy(a, t, f, s)`|æ‹·è´å¤–éƒ¨åˆçº¦å­—èŠ‚ç |
|`extcodehash(a)`|èŽ·å–å¤–éƒ¨åœ°å€çš„ä»£ç å“ˆå¸Œ|
æŽ§åˆ¶æµå’Œç»“æž„

|æŒ‡ä»¤|è¯´æ˜Ž|
|---|---|
|`if cond { ... }`|æ¡ä»¶è¯­å¥|
|`switch expr case val { ... } default { ... }`|åˆ†æ”¯|
|`for { init } cond { post } { body }`|å¾ªçŽ¯|
|`break` / `continue`|è·³å‡ºå¾ªçŽ¯æˆ–ç»§ç»­ä¸‹ä¸€è½®|
|`revert(p, s)`|å›žé€€å¹¶è¿”å›žå†…å­˜æ®µï¼ˆpå¼€å§‹ï¼Œé•¿åº¦sï¼‰|
|`return(p, s)`|è¿”å›žå†…å­˜æ®µ|
|`stop()`|åœæ­¢æ‰§è¡Œ|
|`invalid()`|è§¦å‘ invalid æ“ä½œç ï¼ˆunreachableï¼‰|


ä½Žçº§è°ƒç”¨ç›¸å…³

| æŒ‡ä»¤                                              | è¯´æ˜Ž           |
| ----------------------------------------------- | ------------ |
| `call(g, to, val, in, inSize, out, outSize)`    | æ™®é€šè°ƒç”¨         |
| `delegatecall(g, to, in, inSize, out, outSize)` | ä»£ç†è°ƒç”¨         |
| `staticcall(g, to, in, inSize, out, outSize)`   | åªè¯»è°ƒç”¨         |
| `create(v, p, s)`                               | åˆ›å»ºåˆçº¦         |
| `create2(v, p, s, salt)`                        | ä½¿ç”¨ `create2` |
| `selfdestruct(addr)`                            | é”€æ¯åˆçº¦å¹¶è½¬ç§»ä½™é¢    |

#### åœ¨åˆçº¦é‡Œé¢å¦‚ä½•åˆ¤æ–­åœ°å€æ˜¯ EOA åœ°å€è¿˜æ˜¯åˆçº¦åœ°å€

Extcodesize:

- EXTCODESIZE
- stateDB.getCodeSize()

size := extcodesize(addr)

- EXTCODESIZE
    - stateDB.getCodeSize() // åˆçº¦ï¼šsize > 0
    - stateDB.getCodeSize() // EOAï¼šsize == 0